// Estado global
let S={u:null,us:[{id:1,username:'admin',password:'admin123',role:'admin',name:'Admin',rango:''}],tm:{},cd:{},cda:{},rc:[],ac:[],cm:[],v:'login',cp:false,eu:null};
let ti=null;

// Almacenamiento
function sv(){try{localStorage.setItem('gf',JSON.stringify({us:S.us,rc:S.rc,ac:S.ac,cm:S.cm,cd:S.cd,cda:S.cda}))}catch(e){}}
function ld(){try{let d=JSON.parse(localStorage.getItem('gf'));if(d){S.us=d.us||S.us;S.rc=d.rc||[];S.ac=d.ac||[];S.cm=d.cm||[];S.cd=d.cd||{};S.cda=d.cda||{}}}catch(e){}}

// Formatear tiempo
function fmt(s){let h=Math.floor(s/3600),m=Math.floor(s%3600/60),sec=s%60;return `${h}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`}

// Login
function login(e){e.preventDefault();let u=document.getElementById('u').value,p=document.getElementById('p').value,user=S.us.find(x=>x.username===u&&x.password===p);if(user){S.u=user;S.v=user.role==='admin'?'admin':user.role==='alto'?'alto':'bajo';r();sti()}else alert('âŒ Credenciales incorrectas')}

// Logout
function logout(){S.u=null;S.v='login';S.eu=null;if(ti){clearInterval(ti);ti=null}r()}

// Timer interval
function sti(){if(ti)return;ti=setInterval(()=>{let h=false;Object.keys(S.tm).forEach(u=>{if(S.tm[u].r){S.tm[u].e++;h=true}});if(h)document.querySelectorAll('.tm').forEach(el=>{let u=el.dataset.uid;if(S.tm[u])el.textContent=fmt(S.tm[u].e)})},1000)}

// Generar cÃ³digo tiempo
function gc(){let c=Math.random().toString(36).substring(2,8).toUpperCase();S.cd[c]={ai:S.u.id,an:S.u.name};sv();alert('âœ… CÃ³digo de Tiempo: '+c);r()}

// Generar cÃ³digo acta
function gca(){let c=Math.random().toString(36).substring(2,8).toUpperCase();S.cda[c]={ai:S.u.id,an:S.u.name};sv();alert('âœ… CÃ³digo de Acta: '+c);r()}

// Iniciar timer
function st(){let c=document.getElementById('cd').value.toUpperCase();if(!S.cd[c]){alert('âŒ CÃ³digo invÃ¡lido');return}S.tm[S.u.id]={e:0,r:true,ai:S.cd[c].ai,an:S.cd[c].an};r()}

// Detener timer usuario
function stpu(uid){let t=S.tm[uid];if(t){let sec=t.e,m=Math.floor(sec/60),h=Math.floor(m/60),u=S.us.find(x=>x.id===uid);S.rc.push({id:S.rc.length+1,uid:uid,un:u.name,ai:t.ai,an:t.an,h:h,m:m%60,s:sec%60,d:new Date().toISOString()});delete S.tm[uid];sv();alert(`âœ… Detenido: ${u.name} - ${h}h ${m%60}m ${sec%60}s`);r()}}

// Agregar usuario
function au(e){e.preventDefault();let n=document.getElementById('un').value,u=document.getElementById('uu').value,p=document.getElementById('up').value,ro=document.getElementById('ur').value,rg=document.getElementById('urg').value||'';if(S.us.find(x=>x.username===u)){alert('âŒ Usuario existe');return}S.us.push({id:S.us.length+1,username:u,password:p,role:ro,name:n,rango:rg});sv();alert('âœ… Usuario creado');r()}

// Editar usuario
function seu(id){S.eu=S.us.find(u=>u.id===id);r()}

// Guardar ediciÃ³n
function esu(e){e.preventDefault();let n=document.getElementById('eun').value,u=document.getElementById('euu').value,p=document.getElementById('eup').value,ro=document.getElementById('eur').value,rg=document.getElementById('eurg').value||'';let user=S.us.find(x=>x.id===S.eu.id);user.name=n;user.username=u;user.password=p;user.role=ro;user.rango=rg;if(S.u.id===user.id){S.u=user}S.eu=null;sv();alert('âœ… Usuario actualizado');r()}

// Agregar acta (Admin)
function aa(e){e.preventDefault();let uid=parseInt(document.getElementById('auid').value),mot=document.getElementById('amot').value,u=S.us.find(x=>x.id===uid);S.ac.push({id:S.ac.length+1,uid:uid,un:u.name,mot:mot,by:S.u.name,d:new Date().toISOString()});sv();alert('âœ… Acta creada');r()}

// Agregar acta (Cargo Alto)
function aaa(e){e.preventDefault();let uid=parseInt(document.getElementById('aauid').value),mot=document.getElementById('aamot').value,cod=document.getElementById('aacod').value.toUpperCase();if(!S.cda[cod]){alert('âŒ CÃ³digo de autorizaciÃ³n invÃ¡lido');return}let u=S.us.find(x=>x.id===uid);S.ac.push({id:S.ac.length+1,uid:uid,un:u.name,mot:mot,by:S.u.name,aut:S.cda[cod].an,d:new Date().toISOString()});delete S.cda[cod];sv();alert('âœ… Acta creada con autorizaciÃ³n');r()}

// Agregar comunicado
function acm(e){e.preventDefault();if(S.cm.length>=10){alert('âŒ MÃ¡ximo 10 comunicados');return}let t=document.getElementById('cmt').value,c=document.getElementById('cmc').value;S.cm.push({id:S.cm.length+1,t:t,c:c,by:S.u.name,d:new Date().toISOString()});sv();alert('âœ… Comunicado creado');r()}

// Eliminar comunicado
function dcm(id){if(confirm('Â¿Eliminar comunicado?')){S.cm=S.cm.filter(x=>x.id!==id);sv();r()}}

// Cambiar contraseÃ±a
function cp(e){e.preventDefault();let curr=document.getElementById('cpc').value,newp=document.getElementById('cpn').value;if(S.u.password!==curr){alert('âŒ ContraseÃ±a actual incorrecta');return}if(newp.length<3){alert('âŒ MÃ­nimo 3 caracteres');return}let u=S.us.find(u=>u.id===S.u.id);u.password=newp;S.u.password=newp;S.cp=false;sv();alert('âœ… ContraseÃ±a cambiada exitosamente');r()}

// Ver actas
function va(){S.v='ver-actas';r()}

// Crear acta alto
function caa(){S.v='crear-acta-alto';r()}

// Render
function r(){
let a=document.getElementById('app');

// LOGIN
if(S.v==='login')a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-blue-900 via-blue-800 to-purple-900 flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-10 w-full max-w-md transform hover:scale-105 transition-transform duration-300"><div class="text-center mb-8"><h1 class="text-5xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">GestorFederal</h1><p class="text-gray-500 text-lg">Control de Tiempos & GestiÃ³n</p></div><form onsubmit="login(event)" class="space-y-5"><div class="relative"><input type="text" id="u" placeholder="Usuario" required class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all"><span class="absolute right-4 top-4 text-2xl">ğŸ‘¤</span></div><div class="relative"><input type="password" id="p" placeholder="ContraseÃ±a" required class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all"><span class="absolute right-4 top-4 text-2xl">ğŸ”’</span></div><button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-xl transform hover:scale-105 transition-all">Ingresar</button></form><div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200"><p class="text-sm text-gray-700">ğŸ”‘ Demo: <b>admin / admin123</b></p></div></div></div>`;

// ADMIN
else if(S.v==='admin')a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50"><nav class="bg-gradient-to-r from-blue-900 to-purple-900 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><div><h1 class="text-2xl font-bold">ğŸ›¡ï¸ Panel Admin</h1><p class="text-sm text-blue-200">${S.u.name}</p></div><div class="flex gap-3"><button onclick="S.cp=true;r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105">ğŸ”‘</button><button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-5 py-2 rounded-lg font-semibold transition-all transform hover:scale-105">Salir</button></div></div></nav>${S.cp?`<div class="container mx-auto p-4"><div class="bg-white rounded-2xl shadow-xl p-8 max-w-md mx-auto border-2 border-blue-200"><h2 class="text-2xl font-bold mb-6 text-blue-900">ğŸ”‘ Cambiar ContraseÃ±a</h2><form onsubmit="cp(event)" class="space-y-4"><input type="password" id="cpc" placeholder="ContraseÃ±a Actual" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="password" id="cpn" placeholder="Nueva ContraseÃ±a" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><div class="flex gap-3"><button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">Guardar</button><button type="button" onclick="S.cp=false;r()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-xl font-bold transition-all">Cancelar</button></div></form></div></div>`:`<div class="container mx-auto p-6"><div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">${[{v:'users',i:'ğŸ‘¥',t:'Usuarios',c:'from-blue-500 to-blue-600'},{v:'actas',i:'ğŸ“„',t:'Actas',c:'from-red-500 to-red-600'},{v:'bit',i:'ğŸ†',t:'BitÃ¡cora',c:'from-purple-500 to-purple-600'},{v:'coms',i:'ğŸ“¢',t:'Comunicados',c:'from-green-500 to-green-600'}].map(x=>`<button onclick="S.v='${x.v}';r()" class="bg-gradient-to-br ${x.c} text-white p-8 rounded-2xl shadow-lg hover:shadow-2xl transform hover:scale-105 transition-all"><div class="text-5xl mb-3">${x.i}</div><h3 class="font-bold text-xl">${x.t}</h3></button>`).join('')}</div><div class="grid md:grid-cols-2 gap-6 mb-6"><div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-blue-500"><h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ”‘ CÃ³digos de Tiempo</h2><button onclick="gc()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all mb-4">â• Generar CÃ³digo</button><div class="space-y-2 max-h-48 overflow-y-auto">${Object.entries(S.cd).map(([c,d])=>`<div class="bg-blue-50 p-3 rounded-xl border border-blue-200 flex justify-between items-center"><span class="font-mono font-bold text-xl text-blue-700">${c}</span><span class="text-sm text-gray-600">Por: ${d.an}</span></div>`).join('')||'<p class="text-gray-400 text-center py-4">Sin cÃ³digos activos</p>'}</div></div><div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-purple-500"><h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ“ CÃ³digos de Actas</h2><button onclick="gca()" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all mb-4">â• Generar CÃ³digo</button><div class="space-y-2 max-h-48 overflow-y-auto">${Object.entries(S.cda).map(([c,d])=>`<div class="bg-purple-50 p-3 rounded-xl border border-purple-200 flex justify-between items-center"><span class="font-mono font-bold text-xl text-purple-700">${c}</span><span class="text-sm text-gray-600">Por: ${d.an}</span></div>`).join('')||'<p class="text-gray-400 text-center py-4">Sin cÃ³digos activos</p>'}</div></div></div><div class="bg-white rounded-2xl shadow-lg p-8 border-t-4 border-blue-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“Š EstadÃ­sticas Generales</h2><div class="grid grid-cols-3 gap-6">${[{l:'Usuarios',v:S.us.length,c:'blue',i:'ğŸ‘¥'},{l:'Registros',v:S.rc.length,c:'green',i:'âœ…'},{l:'Actas',v:S.ac.length,c:'red',i:'ğŸ“„'}].map(x=>`<div class="bg-gradient-to-br from-${x.c}-50 to-${x.c}-100 p-6 rounded-xl border-2 border-${x.c}-200 transform hover:scale-105 transition-all"><div class="flex justify-between items-start mb-2"><p class="text-sm font-semibold text-${x.c}-700">${x.l}</p><span class="text-2xl">${x.i}</span></div><p class="text-5xl font-bold text-${x.c}-600">${x.v}</p></div>`).join('')}</div></div></div>`}</div>`;

// USUARIOS
else if(S.v==='users'){let on=Object.keys(S.tm).map(x=>parseInt(x));a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50"><nav class="bg-gradient-to-r from-blue-900 to-purple-900 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><h1 class="text-2xl font-bold">ğŸ‘¥ GestiÃ³n de Usuarios</h1><button onclick="S.v='admin';r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-5 py-2 rounded-lg font-semibold transition-all">â† Volver</button></div></nav><div class="container mx-auto p-6">${S.eu?`<div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-2 border-blue-500"><h2 class="text-2xl font-bold mb-6 text-blue-900">âœï¸ Editar Usuario</h2><form onsubmit="esu(event)" class="grid grid-cols-2 gap-4"><input type="text" id="eun" value="${S.eu.name}" placeholder="Nombre" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="text" id="euu" value="${S.eu.username}" placeholder="Usuario" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="text" id="eup" value="${S.eu.password}" placeholder="ContraseÃ±a" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><select id="eur" class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><option value="bajo" ${S.eu.role==='bajo'?'selected':''}>Cargo Bajo</option><option value="alto" ${S.eu.role==='alto'?'selected':''}>Cargo Alto</option><option value="admin" ${S.eu.role==='admin'?'selected':''}>Admin</option></select><input type="text" id="eurg" value="${S.eu.rango||''}" placeholder="Rango (opcional)" class="col-span-2 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><div class="col-span-2 flex gap-3"><button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">ğŸ’¾ Guardar</button><button type="button" onclick="S.eu=null;r()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-xl font-bold transition-all">Cancelar</button></div></form></div>`:`<div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-blue-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">â• Crear Usuario</h2><form onsubmit="au(event)" class="grid grid-cols-2 gap-4"><input type="text" id="un" placeholder="Nombre completo" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="text" id="uu" placeholder="Usuario" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="password" id="up" placeholder="ContraseÃ±a" required class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><select id="ur" class="px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><option value="bajo">Cargo Bajo</option><option value="alto">Cargo Alto</option><option value="admin">Admin</option></select><input type="text" id="urg" placeholder="Rango (opcional): Nivel 1, Senior..." class="col-span-2 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><button type="submit" class="col-span-2 bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">â• Crear Usuario</button></form></div>`}<div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-purple-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ“‹ Lista de Usuarios</h2><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gradient-to-r from-blue-500 to-purple-500 text-white"><tr><th class="px-6 py-4 text-left rounded-tl-xl">Estado</th><th class="px-6 py-4 text-left">Nombre</th><th class="px-6 py-4 text-left">Usuario</th><th class="px-6 py-4 text-left">Rol</th><th class="px-6 py-4 text-left">Rango</th><th class="px-6 py-4 text-left">Password</th><th class="px-6 py-4 text-left rounded-tr-xl">AcciÃ³n</th></tr></thead><tbody>${S.us.map(u=>`<tr class="border-b hover:bg-blue-50 transition-colors"><td class="px-6 py-4">${on.includes(u.id)?'<span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">ğŸŸ¢ Online</span>':'<span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold">âšª Offline</span>'}</td><td class="px-6 py-4 font-semibold">${u.name}</td><td class="px-6 py-4 text-gray-600">${u.username}</td><td class="px-6 py-4"><span class="px-3 py-1 text-xs font-bold rounded-full ${u.role==='admin'?'bg-red-100 text-red-700':u.role==='alto'?'bg-blue-100 text-blue-700':'bg-green-100 text-green-700'}">${u.role.toUpperCase()}</span></td><td class="px-6 py-4">${u.rango?`<span class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs font-bold">${u.rango}</span>`:'<span class="text-gray-400">-</span>'}</td><td class="px-6 py-4"><span class="font-mono bg-gray-100 px-2 py-1 rounded">${u.password}</span></td><td class="px-6 py-4"><button onclick="seu(${u.id})" class="bg-gradient-to-r from-yellow-400 to-yellow-500 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transform hover:scale-105 transition-all">âœï¸ Editar</button></td></tr>`).join('')}</tbody></table></div></div></div></div>`}

// ACTAS ADMIN
else if(S.v==='actas'){let ma=S.ac;a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-red-50"><nav class="bg-gradient-to-r from-red-900 to-red-700 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><h1 class="text-2xl font-bold">ğŸ“„ GestiÃ³n de Actas</h1><button onclick="S.v='admin';r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-5 py-2 rounded-lg font-semibold transition-all">â† Volver</button></div></nav><div class="container mx-auto p-6"><div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-red-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">â• Crear Acta Administrativa</h2><form onsubmit="aa(event)" class="space-y-4"><select id="auid" class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none" required><option value="">Seleccionar usuario...</option>${S.us.filter(u=>u.role!=='admin').map(u=>`<option value="${u.id}">${u.name} - ${u.role.toUpperCase()}</option>`).join('')}</select><textarea id="amot" placeholder="Motivo de la acta administrativa..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-500 focus:outline-none h-40" required></textarea><button type="submit" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transform hover:scale-105 transition-all">ğŸ“ Crear Acta</button></form></div><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-red-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ“‹ Todas las Actas (${ma.length})</h2>${ma.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“­</div><p class="text-gray-400 text-lg">Sin actas registradas</p></div>':'<div class="space-y-4">'+ma.map(ac=>`<div class="border-2 border-red-200 rounded-xl p-6 bg-gradient-to-r from-red-50 to-orange-50 hover:shadow-lg transition-all"><div class="flex justify-between items-start mb-3"><div><h3 class="text-xl font-bold text-red-900">${ac.un}</h3><p class="text-sm text-gray-600">ğŸ“… ${new Date(ac.d).toLocaleDateString('es-MX',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}</p></div><span class="bg-red-500 text-white px-4 py-2 rounded-full text-sm font-bold">ACTA</span></div><div class="bg-white p-4 rounded-lg mb-3"><p class="text-gray-800 whitespace-pre-line">${ac.mot}</p></div><div class="flex justify-between text-sm"><span class="text-gray-600">ğŸ‘¤ Creada por: <b>${ac.by}</b></span>${ac.aut?`<span class="text-gray-600">âœ… Autorizada por: <b>${ac.aut}</b></span>`:''}</div></div>`).join('')+'</div>'}</div></div></div>`}

// BITÃCORA
else if(S.v==='bit'){let rank={},sup={};S.rc.forEach(r=>{if(!rank[r.uid])rank[r.uid]={un:r.un,t:0};rank[r.uid].t+=(r.h*3600+r.m*60+r.s);if(!sup[r.ai])sup[r.ai]={an:r.an,regs:[]};sup[r.ai].regs.push(r)});let topR=Object.entries(rank).map(([uid,d])=>({...d,uid:parseInt(uid),h:Math.floor(d.t/3600),m:Math.floor((d.t%3600)/60),s:d.t%60})).sort((a,b)=>b.t-a.t);let medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-purple-50"><nav class="bg-gradient-to-r from-purple-900 to-blue-900 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><h1 class="text-2xl font-bold">ğŸ† BitÃ¡cora de Registros</h1><button onclick="S.v='admin';r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-5 py-2 rounded-lg font-semibold transition-all">â† Volver</button></div></nav><div class="container mx-auto p-6"><div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-yellow-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ† Ranking de Tiempos Totales</h2><p class="text-gray-600 mb-6">Los mejores trabajadores por tiempo acumulado</p>${topR.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“Š</div><p class="text-gray-400 text-lg">Sin registros aÃºn</p></div>':'<div class="grid md:grid-cols-3 gap-6 mb-6">'+topR.slice(0,3).map((u,i)=>`<div class="bg-gradient-to-br ${i===0?'from-yellow-100 to-yellow-200 border-yellow-400':i===1?'from-gray-100 to-gray-200 border-gray-400':'from-orange-100 to-orange-200 border-orange-400'} border-4 rounded-2xl p-6 text-center transform hover:scale-105 transition-all shadow-lg"><div class="text-6xl mb-3">${medals[i]}</div><h3 class="text-2xl font-bold mb-2">${u.un}</h3><p class="text-4xl font-bold ${i===0?'text-yellow-700':i===1?'text-gray-700':'text-orange-700'} mb-2">${u.h}h ${u.m}m ${u.s}s</p><span class="inline-block px-4 py-1 bg-white rounded-full text-sm font-bold">Lugar ${i+1}</span></div>`).join('')+'</div><div class="overflow-x-auto"><table class="w-full"><thead class="bg-gradient-to-r from-purple-500 to-blue-500 text-white"><tr><th class="px-4 py-3 text-left rounded-tl-xl">PosiciÃ³n</th><th class="px-4 py-3 text-left">Trabajador</th><th class="px-4 py-3 text-left">Tiempo Total</th><th class="px-4 py-3 text-left rounded-tr-xl">Medalla</th></tr></thead><tbody>'+topR.map((u,i)=>`<tr class="border-b hover:bg-purple-50 transition-colors"><td class="px-4 py-3 font-bold text-lg">#${i+1}</td><td class="px-4 py-3 font-semibold">${u.un}</td><td class="px-4 py-3"><span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full font-bold">${u.h}h ${u.m}m ${u.s}s</span></td><td class="px-4 py-3 text-2xl">${i<3?medals[i]:''}</td></tr>`).join('')+'</tbody></table></div>'}</div><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-blue-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“Š Historial por Supervisor</h2>${Object.keys(sup).length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“­</div><p class="text-gray-400 text-lg">Sin supervisiones registradas</p></div>':'<div class="space-y-6">'+Object.entries(sup).map(([aid,data])=>{let totS=data.regs.reduce((s,r)=>(s+(r.h*3600+r.m*60+r.s)),0),totH=Math.floor(totS/3600),totM=Math.floor((totS%3600)/60),totSe=totS%60;return`<div class="border-2 border-blue-200 rounded-xl p-6 bg-gradient-to-r from-blue-50 to-purple-50 hover:shadow-lg transition-all"><div class="flex justify-between items-center mb-4"><h3 class="text-2xl font-bold text-blue-900">ğŸ‘¤ ${data.an}</h3><div class="text-right"><p class="text-sm text-gray-600">Total supervisado</p><p class="text-3xl font-bold text-blue-700">${totH}h ${totM}m ${totSe}s</p></div></div><div class="overflow-x-auto"><table class="w-full"><thead class="bg-blue-100"><tr><th class="px-3 py-2 text-left">Fecha</th><th class="px-3 py-2 text-left">Trabajador</th><th class="px-3 py-2 text-left">Tiempo</th></tr></thead><tbody>${data.regs.map(r=>`<tr class="border-t hover:bg-white transition-colors"><td class="px-3 py-2 text-sm">${new Date(r.d).toLocaleDateString('es-MX')}</td><td class="px-3 py-2 font-semibold">${r.un}</td><td class="px-3 py-2"><span class="bg-green-100 text-green-700 px-2 py-1 rounded font-bold text-sm">${r.h}h ${r.m}m ${r.s}s</span></td></tr>`).join('')}</tbody></table></div></div>`}).join('')+'</div>'}</div></div></div>`}

// COMUNICADOS
else if(S.v==='coms')a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-green-50"><nav class="bg-gradient-to-r from-green-900 to-green-700 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><h1 class="text-2xl font-bold">ğŸ“¢ Comunicados</h1><button onclick="S.v='admin';r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-5 py-2 rounded-lg font-semibold transition-all">â† Volver</button></div></nav><div class="container mx-auto p-6"><div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-green-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">â• Crear Comunicado</h2><form onsubmit="acm(event)" class="space-y-4"><input type="text" id="cmt" placeholder="TÃ­tulo del comunicado" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none"><textarea id="cmc" placeholder="Contenido del comunicado..." class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none h-40" required></textarea><button type="submit" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white py-4 rounded-xl font-bold text-lg hover:shadow-lg transform hover:scale-105 transition-all">ğŸ“¢ Publicar Comunicado</button></form></div><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-green-500"><h2 class="text-2xl font-bold mb-6 text-gray-800">ğŸ“‹ Comunicados Publicados (${S.cm.length}/10)</h2>${S.cm.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“­</div><p class="text-gray-400 text-lg">Sin comunicados publicados</p></div>':'<div class="space-y-4">'+S.cm.map(c=>`<div class="border-2 border-green-200 rounded-xl p-6 bg-gradient-to-r from-green-50 to-emerald-50 hover:shadow-lg transition-all"><div class="flex justify-between items-start mb-3"><div class="flex-1"><h3 class="text-xl font-bold text-green-900 mb-1">${c.t}</h3><p class="text-sm text-gray-600">ğŸ“… ${new Date(c.d).toLocaleDateString('es-MX',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})} â€¢ Por: <b>${c.by}</b></p></div><button onclick="dcm(${c.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-semibold transition-all transform hover:scale-105">ğŸ—‘ï¸</button></div><div class="bg-white p-4 rounded-lg"><p class="text-gray-800 whitespace-pre-line">${c.c}</p></div></div>`).join('')+'</div>'}</div></div></div>`;

// CARGO BAJO
else if(S.v==='bajo'){let t=S.tm[S.u.id],mr=S.rc.filter(r=>r.uid===S.u.id),totS=mr.reduce((s,r)=>(s+(r.h*3600+r.m*60+r.s)),0),totH=Math.floor(totS/3600),totM=Math.floor((totS%3600)/60),totSe=totS%60,myA=S.ac.filter(ac=>ac.uid===S.u.id);a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-green-50"><nav class="bg-gradient-to-r from-green-700 to-green-600 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><div><h1 class="text-2xl font-bold">ğŸ‘· ${S.u.name}</h1>${S.u.rango?`<p class="text-sm text-green-200">ğŸ… ${S.u.rango}</p>`:''}</div><div class="flex gap-3"><button onclick="va()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105 relative">${myA.length>0?`<span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-6 h-6 rounded-full flex items-center justify-center font-bold">${myA.length}</span>`:''}ğŸ“„</button><button onclick="S.cp=true;r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105">ğŸ”‘</button><button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-5 py-2 rounded-lg font-semibold transition-all transform hover:scale-105">Salir</button></div></div></nav><div class="container mx-auto p-6">${S.cp?`<div class="bg-white rounded-2xl shadow-xl p-8 max-w-md mx-auto mb-6 border-2 border-green-500"><h2 class="text-2xl font-bold mb-6 text-green-900">ğŸ”‘ Cambiar ContraseÃ±a</h2><form onsubmit="cp(event)" class="space-y-4"><input type="password" id="cpc" placeholder="ContraseÃ±a Actual" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none"><input type="password" id="cpn" placeholder="Nueva ContraseÃ±a" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-green-500 focus:outline-none"><div class="flex gap-3"><button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">Guardar</button><button type="button" onclick="S.cp=false;r()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-xl font-bold transition-all">Cancelar</button></div></form></div>`:''}<div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-green-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">â±ï¸ Control de Tiempo</h2>${!t?`<div class="space-y-4"><p class="text-lg text-gray-700 mb-4">Solicita un cÃ³digo a tu supervisor para iniciar:</p><div class="flex gap-3"><input type="text" id="cd" placeholder="INGRESA CÃ“DIGO" class="flex-1 px-6 py-4 border-2 border-green-300 rounded-xl uppercase font-mono text-xl focus:border-green-500 focus:outline-none" maxlength="6"><button onclick="st()" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:shadow-lg transform hover:scale-105 transition-all">â–¶ï¸ Iniciar</button></div></div>`:`<div class="space-y-6"><div class="bg-gradient-to-br from-green-100 to-green-200 border-4 border-green-400 p-8 rounded-2xl text-center shadow-lg"><p class="text-7xl font-bold text-green-700 tm mb-4" data-uid="${S.u.id}">${fmt(t.e)}</p><p class="text-lg text-green-800">â° CronÃ³metro activo</p><p class="text-sm text-green-700 mt-2">Supervisor: <b>${t.an}</b></p></div><div class="bg-yellow-50 border-2 border-yellow-300 p-6 rounded-xl"><p class="text-center text-yellow-800 font-semibold">âš ï¸ Solo tu supervisor puede detener el cronÃ³metro</p></div></div>`}</div><div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-blue-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ’° Tiempo Total Acumulado</h2><div class="bg-gradient-to-br from-blue-100 to-blue-200 border-4 border-blue-400 p-8 rounded-2xl text-center shadow-lg"><p class="text-6xl font-bold text-blue-700 mb-2">${totH}h ${totM}m ${totSe}s</p><p class="text-blue-700 font-semibold">${mr.length} registros completados</p></div></div><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-purple-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“Š Mi Historial</h2>${mr.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ“­</div><p class="text-gray-400 text-lg">Sin registros aÃºn</p></div>':'<div class="overflow-x-auto"><table class="w-full"><thead class="bg-gradient-to-r from-purple-500 to-blue-500 text-white"><tr><th class="px-4 py-3 text-left rounded-tl-xl">Fecha</th><th class="px-4 py-3 text-left">Tiempo</th><th class="px-4 py-3 text-left rounded-tr-xl">Supervisor</th></tr></thead><tbody>'+mr.map(r=>`<tr class="border-b hover:bg-purple-50 transition-colors"><td class="px-4 py-3">${new Date(r.d).toLocaleDateString('es-MX',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})}</td><td class="px-4 py-3"><span class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-bold">${r.h}h ${r.m}m ${r.s}s</span></td><td class="px-4 py-3 font-semibold">${r.an}</td></tr>`).join('')+'</tbody></table></div>'}</div>${S.cm.length>0?`<div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-green-500 mt-6"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“¢ Comunicados</h2><div class="space-y-4">${S.cm.map(c=>`<div class="border-2 border-green-200 rounded-xl p-6 bg-gradient-to-r from-green-50 to-emerald-50"><h3 class="text-xl font-bold text-green-900 mb-2">${c.t}</h3><p class="text-sm text-gray-600 mb-3">ğŸ“… ${new Date(c.d).toLocaleDateString('es-MX')}</p><p class="text-gray-800 whitespace-pre-line">${c.c}</p></div>`).join('')}</div></div>`:''}</div></div>`}

// VER ACTAS (CARGO BAJO)
else if(S.v==='ver-actas'){let myA=S.ac.filter(ac=>ac.uid===S.u.id);a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-red-50"><nav class="bg-gradient-to-r from-red-700 to-red-600 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><h1 class="text-2xl font-bold">ğŸ“„ Mis Actas</h1><button onclick="S.v='bajo';r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-5 py-2 rounded-lg font-semibold transition-all">â† Volver</button></div></nav><div class="container mx-auto p-6"><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-red-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ“‹ Actas Registradas (${myA.length})</h2>${myA.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">âœ…</div><p class="text-gray-400 text-lg">Sin actas administrativas</p></div>':'<div class="space-y-4">'+myA.map(ac=>`<div class="border-2 border-red-200 rounded-xl p-6 bg-gradient-to-r from-red-50 to-orange-50 hover:shadow-lg transition-all"><div class="flex justify-between items-start mb-3"><div><h3 class="text-xl font-bold text-red-900">Acta Administrativa</h3><p class="text-sm text-gray-600">ğŸ“… ${new Date(ac.d).toLocaleDateString('es-MX',{year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit'})}</p></div><span class="bg-red-500 text-white px-4 py-2 rounded-full text-sm font-bold">ACTA</span></div><div class="bg-white p-4 rounded-lg mb-3"><p class="text-gray-800 whitespace-pre-line">${ac.mot}</p></div><div class="text-sm text-gray-600"><p>ğŸ‘¤ Creada por: <b>${ac.by}</b></p>${ac.aut?`<p>âœ… Autorizada por: <b>${ac.aut}</b></p>`:''}</div></div>`).join('')+'</div>'}</div></div></div>`}

// CARGO ALTO
else if(S.v==='alto'){let act=Object.entries(S.tm).filter(([uid])=>{let u=S.us.find(x=>x.id===parseInt(uid));return u&&u.role==='bajo'}).map(([uid,t])=>{let u=S.us.find(x=>x.id===parseInt(uid));return{...t,uid:parseInt(uid),un:u?.name}}),mr=S.rc.filter(r=>r.ai===S.u.id),totS=mr.reduce((s,r)=>(s+(r.h*3600+r.m*60+r.s)),0),totH=Math.floor(totS/3600),totM=Math.floor((totS%3600)/60),totSe=totS%60,myA=S.ac.filter(ac=>ac.uid===S.u.id);a.innerHTML=`<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50"><nav class="bg-gradient-to-r from-blue-700 to-blue-600 text-white p-5 shadow-lg"><div class="container mx-auto flex justify-between items-center"><div><h1 class="text-2xl font-bold">ğŸ‘” ${S.u.name}</h1>${S.u.rango?`<p class="text-sm text-blue-200">ğŸ… ${S.u.rango}</p>`:''}</div><div class="flex gap-3"><button onclick="caa()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105">â•ğŸ“„</button><button onclick="va()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105 relative">${myA.length>0?`<span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-6 h-6 rounded-full flex items-center justify-center font-bold">${myA.length}</span>`:''}ğŸ“„</button><button onclick="S.cp=true;r()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition-all transform hover:scale-105">ğŸ”‘</button><button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-5 py-2 rounded-lg font-semibold transition-all transform hover:scale-105">Salir</button></div></div></nav><div class="container mx-auto p-6">${S.cp?`<div class="bg-white rounded-2xl shadow-xl p-8 max-w-md mx-auto mb-6 border-2 border-blue-500"><h2 class="text-2xl font-bold mb-6 text-blue-900">ğŸ”‘ Cambiar ContraseÃ±a</h2><form onsubmit="cp(event)" class="space-y-4"><input type="password" id="cpc" placeholder="ContraseÃ±a Actual" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><input type="password" id="cpn" placeholder="Nueva ContraseÃ±a" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"><div class="flex gap-3"><button type="submit" class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">Guardar</button><button type="button" onclick="S.cp=false;r()" class="flex-1 bg-gray-400 hover:bg-gray-500 text-white py-3 rounded-xl font-bold transition-all">Cancelar</button></div></form></div>`:''}<div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-green-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ’° Mi Total Supervisado</h2><div class="bg-gradient-to-br from-green-100 to-green-200 border-4 border-green-400 p-8 rounded-2xl text-center shadow-lg"><p class="text-6xl font-bold text-green-700 mb-2">${totH}h ${totM}m ${totSe}s</p><p class="text-green-700 font-semibold">${mr.length} registros supervisados</p></div></div><div class="bg-white rounded-2xl shadow-xl p-8 mb-6 border-t-4 border-blue-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ”‘ CÃ³digos de Tiempo</h2><button onclick="gc()" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white py-4 rounded-xl font-bold text-lg mb-6 hover:shadow-lg transform hover:scale-105 transition-all">â• Generar CÃ³digo</button><div class="grid md:grid-cols-3 gap-4">${Object.entries(S.cd).filter(([c,d])=>d.ai===S.u.id).map(([c])=>`<div class="bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300 p-6 rounded-xl text-center shadow hover:shadow-lg transition-all transform hover:scale-105"><p class="text-sm text-gray-600 mb-2">CÃ³digo activo</p><p class="font-mono font-bold text-3xl text-blue-700">${c}</p></div>`).join('')||'<p class="col-span-3 text-gray-400 text-center py-6">Sin cÃ³digos generados</p>'}</div></div><div class="bg-white rounded-2xl shadow-xl p-8 border-t-4 border-purple-500"><h2 class="text-3xl font-bold mb-6 text-gray-800">ğŸ‘¥ Trabajadores Activos</h2>${act.length===0?'<div class="text-center py-12"><div class="text-6xl mb-4">ğŸ’¤</div><p class="text-gray-400 text-lg">Sin trabajadores activos</p></div>':'<div class="grid md:grid-cols-3 gap-6">'+act.map(a=>`<div class="border-2 border-green-300 rounded-xl p-6 bg-gradient-to-br from-green-50 to-green-100 hover:shadow-xl transition-all transform hover:scale-105"><h3 class="text-xl font-bold mb-4 text-green-900">${a.un}</h3><p class="text-5xl font-bold text-green-700 tm mb-4" data-uid="${a.uid}">${fmt(a.e)}</p><button onclick="stpu(${a.uid})" class="w-full bg-gradient-to-r from-red-500 to-red-600 text-white py-3 rounded-xl font-bold hover:shadow-lg transform hover:scale-105 transition-all">
