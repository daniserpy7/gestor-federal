<tr class="border-t">
                                                <td class="px-4 py-2">${getStatusBadge(u.id)}</td>
                                                <td class="px-4 py-2">${u.name}</td>
                                                <td class="px-4 py-2">${u.username}</td>
                                                <td class="px-4 py-2">
                                                    <span class="px-2 py-1 text-xs rounded ${
                                                        u.role==='admin'?'bg-red-100 text-red-800':
                                                        u.role==='alto'?'bg-blue-100 text-blue-800':
                                                        'bg-green-100 text-green-800'
                                                    }">
                                                        ${u.role==='admin'?'Admin':u.role==='alto'?'Cargo Alto':'Cargo Bajo'}
                                                    </span>
                                                </td>
                                                <td class="px-4 py-2">${u.password}</td>
                                                <td class="px-4 py-2">
                                                    <button onclick="editUser(${u.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‚úèÔ∏è Editar</button>
                                                </td>
                                            </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'actas') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">Actas Administrativas</h1>
                                <button onclick="state.view='admin';render()" class="bg-blue-700 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            ${state.editingActa ? `
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-6 rounded-lg">
                                <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Editando Acta</h2>
                                <form onsubmit="saveActa(event)" class="space-y-4">
                                    <div>
                                        <p class="text-sm text-gray-600 mb-2">Trabajador: <strong>${state.editingActa.uname}</strong></p>
                                        <p class="text-sm text-gray-600 mb-2">Creada por: ${state.editingActa.by}</p>
                                    </div>
                                    <textarea id="editMot" class="w-full px-4 py-2 border rounded h-32" required>${state.editingActa.mot}</textarea>
                                    <div class="flex gap-2">
                                        <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">üíæ Guardar</button>
                                        <button type="button" onclick="cancelEdit()" class="bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600">‚ùå Cancelar</button>
                                    </div>
                                </form>
                            </div>
                            ` : `
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Crear Acta Administrativa</h2>
                                <form onsubmit="addActa(event)" class="space-y-4">
                                    <select id="au" class="w-full px-4 py-2 border rounded" required>
                                        <option value="">Seleccionar trabajador</option>
                                        ${state.users.filter(u => u.role !== 'admin').map(u => `<option value="${u.id}">${u.name}</option>`).join('')}
                                    </select>
                                    <textarea id="am" placeholder="Motivo del acta" class="w-full px-4 py-2 border rounded h-32" required></textarea>
                                    <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">Crear Acta</button>
                                </form>
                            </div>
                            `}
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Actas Registradas</h2>
                                ${state.actas.length === 0 ? '<p class="text-gray-500 text-center py-4">Sin actas</p>' :
                                state.actas.map(a => `
                                <div class="border rounded p-4 mb-4 bg-red-50">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <h3 class="font-bold text-lg">${a.uname}</h3>
                                            <p class="text-sm text-gray-600">Por: ${a.by} (${a.byRole==='admin'?'Admin':'Cargo Alto'}) ‚Ä¢ ${new Date(a.date).toLocaleString()}</p>
                                            ${a.edited ? `<p class="text-xs text-gray-500 mt-1">‚úèÔ∏è Editada por ${a.editedBy} el ${new Date(a.editedDate).toLocaleString()}</p>` : ''}
                                        </div>
                                        <button onclick="editActa(${a.id})" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">‚úèÔ∏è Editar</button>
                                    </div>
                                    <p class="text-gray-800 mt-2">${a.mot}</p>
                                </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'bit') {
                const stats = calcStats();
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">Bit√°cora Cargos Altos</h1>
                                <button onclick="state.view='admin';render()" class="bg-blue-700 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Horas Completas por Cargo Alto</h2>
                                <p class="text-sm text-gray-600 mb-4">Solo se cuentan horas completas. Los minutos sobrantes se acumulan.</p>
                                <table class="w-full">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left">Cargo Alto</th>
                                            <th class="px-4 py-2 text-left">Horas Completas</th>
                                            <th class="px-4 py-2 text-left">Min. Pendientes</th>
                                            <th class="px-4 py-2 text-left">Total Supervisado</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${stats.length === 0 ? '<tr><td colspan="4" class="px-4 py-8 text-center text-gray-500">Sin datos</td></tr>' :
                                        stats.map(s => `
                                        <tr class="border-t">
                                            <td class="px-4 py-3 font-medium">${s.name}</td>
                                            <td class="px-4 py-3"><span class="bg-green-100 text-green-800 px-3 py-1 rounded-full font-bold">${s.comp}h</span></td>
                                            <td class="px-4 py-3 text-gray-600">${s.pend} min</td>
                                            <td class="px-4 py-3 text-gray-600">${Math.floor(s.tot/60)}h ${s.tot%60}m</td>
                                        </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Registros de Tiempo</h2>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-3 py-2 text-left">Fecha</th>
                                                <th class="px-3 py-2 text-left">Trabajador</th>
                                                <th class="px-3 py-2 text-left">Cargo Alto</th>
                                                <th class="px-3 py-2 text-left">Tiempo</th>
                                                <th class="px-3 py-2 text-left">Tipo</th>
                                                <th class="px-3 py-2 text-left">Detenido por</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${state.records.length === 0 ? '<tr><td colspan="6" class="px-3 py-8 text-center text-gray-500">Sin registros</td></tr>' :
                                            state.records.map(r => `
                                            <tr class="border-t">
                                                <td class="px-3 py-2">${new Date(r.date).toLocaleString()}</td>
                                                <td class="px-3 py-2">${r.userName}</td>
                                                <td class="px-3 py-2">${r.altoName}</td>
                                                <td class="px-3 py-2 font-medium">${r.h}h ${r.m}m ${r.s}s</td>
                                                <td class="px-3 py-2">
                                                    <span class="text-xs px-2 py-1 rounded ${r.manual?'bg-yellow-100 text-yellow-800':'bg-blue-100 text-blue-800'}">
                                                        ${r.manual?'Manual':'Auto'}
                                                    </span>
                                                </td>
                                                <td class="px-3 py-2 text-xs">${r.stoppedBy || '-'}</td>
                                            </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'coms') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">Comunicados (${state.coms.length}/10)</h1>
                                <button onclick="state.view='admin';render()" class="bg-blue-700 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Crear Comunicado</h2>
                                <form onsubmit="addCom(event)" class="space-y-4">
                                    <input type="text" id="ct" placeholder="T√≠tulo del comunicado" required class="w-full px-4 py-2 border rounded">
                                    <textarea id="cc" placeholder="Contenido del comunicado" class="w-full px-4 py-2 border rounded h-32" required></textarea>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="cu" class="w-4 h-4">
                                        <span>Marcar como urgente</span>
                                    </label>
                                    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700" ${state.coms.length >= 10 ? 'disabled' : ''}>Publicar</button>
                                </form>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Comunicados Activos</h2>
                                ${state.coms.length === 0 ? '<p class="text-gray-500 text-center py-4">Sin comunicados</p>' :
                                state.coms.map(c => `
                                <div class="border rounded p-4 mb-4 ${c.urg ? 'bg-red-50 border-red-300' : 'bg-gray-50'}">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-1">
                                                <h3 class="font-bold text-lg">${c.tit}</h3>
                                                ${c.urg ? '<span class="bg-red-500 text-white text-xs px-2 py-1 rounded">URGENTE</span>' : ''}
                                            </div>
                                            <p class="text-sm text-gray-600">Por: ${c.by} ‚Ä¢ ${new Date(c.date).toLocaleString()}</p>
                                        </div>
                                        <button onclick="delCom(${c.id})" class="text-red-600 hover:text-red-800 text-xl">üóëÔ∏è</button>
                                    </div>
                                    <p class="text-gray-800 mt-2">${c.con}</p>
                                </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'team') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">üéÆ Nuestro Equipo Oficial</h1>
                                <button onclick="state.view='admin';render()" class="bg-blue-700 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded">
                                <p class="font-bold text-yellow-800">‚ö†Ô∏è Advertencia Importante</p>
                                <p class="text-sm text-yellow-700">Este es el √öNICO equipo oficial. Cualquier persona que no aparezca aqu√≠ NO es parte de nuestra organizaci√≥n.</p>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Agregar Miembro del Equipo</h2>
                                <form onsubmit="addTeamMember(event)" class="grid grid-cols-3 gap-4">
                                    <input type="text" id="teamName" placeholder="Nombre en el juego" required class="px-4 py-2 border rounded">
                                    <input type="text" id="teamAvatar" placeholder="Avatar/Emoji" required class="px-4 py-2 border rounded">
                                    <input type="text" id="teamDesc" placeholder="Cargo" required class="px-4 py-2 border rounded">
                                    <button type="submit" class="col-span-3 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Agregar al Equipo</button>
                                </form>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Equipo Oficial Verificado ‚úÖ</h2>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${state.team.map((m, idx) => `
                                    <div class="border-2 border-green-500 rounded-lg p-6 bg-green-50 text-center relative">
                                        <button onclick="delTeamMember(${idx})" class="absolute top-2 right-2 text-red-600 hover:text-red-800">üóëÔ∏è</button>
                                        <div class="text-6xl mb-3">${m.avatar}</div>
                                        <h3 class="font-bold text-xl mb-1">${m.name}</h3>
                                        <p class="text-sm text-gray-600">${m.desc}</p>
                                        <div class="mt-3">
                                            <span class="bg-green-500 text-white text-xs px-3 py-1 rounded-full">‚úÖ VERIFICADO</span>
                                        </div>
                                    </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'bajo') {
                const t = state.timers[state.user.id];
                const myRecs = state.records.filter(r => r.userId === state.user.id);
                const myActas = state.actas.filter(a => a.uid === state.user.id);
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-green-700 text-white p-4">
                            <div class="container mx-auto flex justify-between items-center">
                                <h1 class="text-xl font-bold">GestorFederal - ${state.user.name}</h1>
                                <div class="flex gap-2">
                                    <button onclick="state.changingPassword=true;render()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500">üîë</button>
                                    <button onclick="logout()" class="bg-green-600 px-4 py-2 rounded hover:bg-green-500">Salir</button>
                                </div>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            ${state.changingPassword ? `
                            <div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto mb-6">
                                <h2 class="text-xl font-bold mb-4">üîë Cambiar Contrase√±a</h2>
                                <form onsubmit="changePassword(event)" class="space-y-4">
                                    <input type="password" id="currentPass" placeholder="Contrase√±a actual" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="newPass" placeholder="Nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="confirmPass" placeholder="Confirmar nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <div class="flex gap-2">
                                        <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">Guardar</button>
                                        <button type="button" onclick="state.changingPassword=false;render()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">Cancelar</button>
                                    </div>
                                </form>
                            </div>
                            ` : ''}
                            ${state.coms.length > 0 ? `
                            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4 rounded">
                                <h3 class="font-bold text-blue-800 mb-2">üì¢ Comunicados</h3>
                                ${state.coms.map(c => `
                                <div class="mb-2 p-3 rounded ${c.urg?'bg-red-100':'bg-white'}">
                                    <p class="font-medium">${c.tit}</p>
                                    <p class="text-sm text-gray-700">${c.con}</p>
                                </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            ${myActas.length > 0 ? `
                            <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-4 rounded">
                                <h3 class="font-bold text-red-800 mb-2">‚ö†Ô∏è Tienes ${myActas.length} acta(s)</h3>
                                ${myActas.slice(0,2).map(a => `
                                <div class="bg-white p-2 rounded mb-2">
                                    <p class="text-sm font-medium">Motivo: ${a.mot}</p>
                                    <p class="text-xs text-gray-600">Fecha: ${new Date(a.date).toLocaleDateString()}</p>
                                </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
                                <h2 class="text-2xl font-bold mb-4">‚è±Ô∏è Control de Tiempo</h2>
                                ${!t ? `
                                <div class="space-y-4">
                                    <p class="text-gray-700">Solicita un c√≥digo de autorizaci√≥n a tu supervisor:</p>
                                    <div class="flex gap-2">
                                        <input type="text" id="code" placeholder="C√ìDIGO" class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg text-lg uppercase font-mono focus:border-green-500 focus:outline-none">
                                        <button onclick="startTimer()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 font-medium">‚ñ∂Ô∏è Iniciar</button>
                                    </div>
                                    <p class="text-xs text-gray-500">‚è±Ô∏è Los c√≥digos expiran en 2 minutos</p>
                                </div>
                                ` : `
                                <div class="space-y-4">
                                    <div class="bg-green-50 p-6 rounded-lg text-center border-2 border-green-200">
                                        <p class="text-sm text-gray-600 mb-2">Tiempo Actual</p>
                                        <p class="text-5xl font-bold text-green-700 mb-2 timer-display" data-user-id="${state.user.id}">${fmt(t.elapsed)}</p>
                                        <p class="text-sm text-gray-700">Supervisado por: <strong>${t.altoName}</strong></p>
                                        <p class="text-xs text-gray-500 mt-1">${t.running ? 'üü¢ Corriendo' : '‚è∏Ô∏è Pausado'}</p>
                                    </div>
                                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                                        <p class="text-sm text-yellow-800">‚ö†Ô∏è Solo tu supervisor puede detener tu tiempo</p>
                                    </div>
                                </div>
                                `}
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">üìä Mi Historial</h2>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-2 text-left">Fecha</th>
                                                <th class="px-4 py-2 text-left">Tiempo</th>
                                                <th class="px-4 py-2 text-left">Supervisor</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${myRecs.length === 0 ? '<tr><td colspan="3" class="px-4 py-8 text-center text-gray-500">Sin registros</td></tr>' :
                                            myRecs.map(r => `
                                            <tr class="border-t">
                                                <td class="px-4 py-3">${new Date(r.date).toLocaleString()}</td>
                                                <td class="px-4 py-3 font-medium text-green-700">${r.h}h ${r.m}m ${r.s}s</td>
                                                <td class="px-4 py-3">${r.altoName}</td>
                                            </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'alto') {
                const activos = Object.entries(state.timers).map(([uid, t]) => {
                    const u = state.users.find(x => x.id === parseInt(uid));
                    return {...t, uid: parseInt(uid), uname: u?.name};
                });
                const myCodes = Object.entries(state.codes).filter(([c, d]) => d.altoId === state.user.id && !d.used);
                const myAdminCodes = Object.entries(state.adminCodes).filter(([c, d]) => !d.used);
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-700 text-white p-4">
                            <div class="container mx-auto flex justify-between items-center">
                                <h1 class="text-xl font-bold">Cargo Alto - ${state.user.name}</h1>
                                <div class="flex gap-2">
                                    <button onclick="state.view='alto-actas';render()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">üìÑ Actas</button>
                                    <button onclick="state.changingPassword=true;render()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">üîë</button>
                                    <button onclick="logout()" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-500">Salir</button>
                                </div>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            ${state.changingPassword ? `
                            <div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto mb-6">
                                <h2 class="text-xl font-bold mb-4">üîë Cambiar Contrase√±a</h2>
                                <form onsubmit="changePassword(event)" class="space-y-4">
                                    <input type="password" id="currentPass" placeholder="Contrase√±a actual" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="newPass" placeholder="Nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="confirmPass" placeholder="Confirmar nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <div class="flex gap-2">
                                        <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">Guardar</button>
                                        <button type="button" onclick="state.changingPassword=false;render()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">Cancelar</button>
                                    </div>
                                </form>
                            </div>
                            ` : ''}
                            ${state.coms.length > 0 ? `
                            <div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4 rounded">
                                <h3 class="font-bold text-blue-800 mb-2">üì¢ Comunicados</h3>
                                ${state.coms.map(c => `
                                <div class="mb-2 p-3 rounded ${c.urg?'bg-red-100':'bg-white'}">
                                    <p class="font-medium">${c.tit}</p>
                                    <p class="text-sm text-gray-700">${c.con}</p>
                                </div>
                                `).join('')}
                            </div>
                            ` : ''}
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div class="bg-white rounded-lg shadow p-6">
                                    <h2 class="text-xl font-bold mb-4">üîë C√≥digos de Autorizaci√≥n</h2>
                                    <button onclick="genCode()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 mb-4 font-medium">‚ûï Generar C√≥digo (2 min)</button>
                                    <h3 class="font-medium mb-2 text-gray-700">C√≥digos Activos (sin usar):</h3>
                                    <div class="space-y-2">
                                        ${myCodes.length === 0 ? '<p class="text-gray-500 text-sm">No hay c√≥digos disponibles</p>' :
                                        myCodes.map(([code, d]) => {
                                            const timeLeft = Math.max(0, Math.floor((d.expires - Date.now()) / 1000));
                                            return `
                                            <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                                                <div class="flex justify-between items-center">
                                                    <span class="font-mono font-bold text-xl text-blue-900">${code}</span>
                                                    <span class="text-xs text-gray-600">‚è±Ô∏è ${Math.floor(timeLeft/60)}:${(timeLeft%60).toString().padStart(2,'0')}</span>
                                                </div>
                                            </div>
                                            `;
                                        }).join('')}
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg shadow p-6">
                                    <h2 class="text-xl font-bold mb-4">‚ûï Agregar Tiempo Manual</h2>
                                    <form onsubmit="addManual(event)" class="space-y-3">
                                        <select id="mu" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none" required>
                                            <option value="">Seleccionar trabajador</option>
                                            ${state.users.filter(u => u.role === 'bajo').map(u => `<option value="${u.id}">${u.name}</option>`).join('')}
                                        </select>
                                        <div class="grid grid-cols-3 gap-2">
                                            <input type="number" id="mh" placeholder="Horas" min="0" value="0" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                            <input type="number" id="mm" placeholder="Min" min="0" max="59" value="0" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                            <input type="number" id="ms" placeholder="Seg" min="0" max="59" value="0" class="px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none">
                                        </div>
                                        <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 font-medium">Agregar Tiempo</button>
                                    </form>
                                </div>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">üë• Trabajadores Activos</h2>
                                ${activos.length === 0 ? '<p class="text-gray-500 text-center py-8">No hay trabajadores activos</p>' :
                                `<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    ${activos.map(a => `
                                    <div class="border-2 rounded-lg p-4 bg-green-50 border-green-200">
                                        <h3 class="font-bold text-lg mb-2 text-gray-800">${a.uname}</h3>
                                        <p class="text-4xl font-bold text-green-700 mb-2 timer-display" data-user-id="${a.uid}">${fmt(a.elapsed)}</p>
                                        <p class="text-sm text-gray-600 mb-3">${a.running ? 'üü¢ Corriendo' : '‚è∏Ô∏è Pausado'}</p>
                                        <button onclick="stopUserTimer(${a.uid})" class="w-full bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 font-medium">‚èπÔ∏è Detener</button>
                                    </div>
                                    `).join('')}
                                </div>`}
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'alto-actas') {
                const myActas = state.actas.filter(a => a.byRole === 'alto');
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-700 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">Mis Actas Administrativas</h1>
                                <button onclick="state.view='alto';render()" class="bg-blue-600 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            <div class="bg-purple-50 border-l-4 border-purple-400 p-4 mb-6 rounded">
                                <p class="font-bold text-purple-800">üîê Necesitas autorizaci√≥n de un Admin</p>
                                <p class="text-sm text-purple-700">Solicita un c√≥digo de autorizaci√≥n para crear actas administrativas</p>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Crear Acta Administrativa</h2>
                                <form onsubmit="addActa(event)" class="space-y-4">
                                    <select id="au" class="w-full px-4 py-2 border rounded" required>
                                        <option value="">Seleccionar trabajador</option>
                                        ${state.users.filter(u => u.role === 'bajo').map(u => `<option value="${u.id}">${u.name}</option>`).join('')}
                                    </select>
                                    <textarea id="am" placeholder="Motivo del acta" class="w-full px-4 py-2 border rounded h-32" required></textarea>
                                    <input type="text" id="actaAuth" placeholder="C√ìDIGO DE AUTORIZACI√ìN ADMIN" class="w-full px-4 py-2 border-2 border-purple-300 rounded uppercase font-mono" required>
                                    <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700">Crear Acta</button>
                                </form>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Actas que he creado</h2>
                                ${myActas.length === 0 ? '<p class="text-gray-500 text-center py-4">No has creado actas</p>' :
                                myActas.map(a => `
                                <div class="border rounded p-4 mb-4 bg-red-50">
                                    <h3 class="font-bold text-lg">${a.uname}</h3>
                                    <p class="text-sm text-gray-600">Fecha: ${new Date(a.date).toLocaleString()}</p>
                                    <p class="text-gray-800 mt-2">${a.mot}</p>
                                </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        load();
        render();
        
        // Detectar actividad del usuario
        document.addEventListener('click', updateActivity);
        document.addEventListener('keypress', updateActivity);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestorFederal</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="app"></div>
    <script>
        let state = {
            user: null,
            users: [{id:1,username:'admin',password:'admin123',role:'admin',name:'Admin'}],
            timers: {},
            codes: {},
            records: [],
            actas: [],
            coms: [],
            adminCodes: {},
            team: [
                {name: 'Director General', avatar: 'üëî', desc: 'CEO y Fundador'},
                {name: 'Jefe de Operaciones', avatar: 'üíº', desc: 'Director de RRHH'},
                {name: 'Supervisor Principal', avatar: 'üë®‚Äçüíº', desc: 'Coordinador General'}
            ],
            view: 'login',
            editingActa: null,
            editingUser: null,
            changingPassword: false,
            onlineUsers: {},
            lastActivity: {}
        };

        let timerInterval = null;
        let activityInterval = null;

        function save() {
            try {
                localStorage.setItem('gf', JSON.stringify({
                    users: state.users,
                    codes: state.codes,
                    records: state.records,
                    actas: state.actas,
                    coms: state.coms,
                    adminCodes: state.adminCodes,
                    team: state.team
                }));
            } catch(e) {}
        }

        function load() {
            try {
                const d = localStorage.getItem('gf');
                if (d) {
                    const parsed = JSON.parse(d);
                    state.users = parsed.users || state.users;
                    state.codes = parsed.codes || {};
                    state.records = parsed.records || [];
                    state.actas = parsed.actas || [];
                    state.coms = parsed.coms || [];
                    state.adminCodes = parsed.adminCodes || {};
                    state.team = parsed.team || state.team;
                }
            } catch(e) {}
        }

        function fmt(s) {
            const h = Math.floor(s/3600);
            const m = Math.floor((s%3600)/60);
            const sec = s%60;
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
        }

        function updateActivity() {
            if (state.user) {
                state.lastActivity[state.user.id] = Date.now();
            }
        }

        function checkOnlineStatus() {
            const now = Date.now();
            Object.keys(state.lastActivity).forEach(uid => {
                const diff = now - state.lastActivity[uid];
                state.onlineUsers[uid] = diff < 60000; // Online si actividad en √∫ltimo minuto
            });
        }

        function updateTimerDisplay() {
            const timerDisplays = document.querySelectorAll('.timer-display');
            timerDisplays.forEach(display => {
                const userId = display.dataset.userId;
                if (state.timers[userId]) {
                    display.textContent = fmt(state.timers[userId].elapsed);
                }
            });
        }

        function cleanExpiredCodes() {
            const now = Date.now();
            Object.keys(state.codes).forEach(code => {
                const data = state.codes[code];
                if (data.expires && now > data.expires) {
                    delete state.codes[code];
                }
            });
            Object.keys(state.adminCodes).forEach(code => {
                const data = state.adminCodes[code];
                if (data.expires && now > data.expires) {
                    delete state.adminCodes[code];
                }
            });
            save();
        }

        function login(e) {
            e.preventDefault();
            const u = document.getElementById('u').value;
            const p = document.getElementById('p').value;
            const user = state.users.find(x => x.username === u && x.password === p);
            if (user) {
                state.user = user;
                state.view = user.role === 'admin' ? 'admin' : user.role === 'alto' ? 'alto' : 'bajo';
                state.lastActivity[user.id] = Date.now();
                state.onlineUsers[user.id] = true;
                render();
                startTimerInterval();
                startActivityInterval();
            } else {
                alert('Credenciales incorrectas');
            }
        }

        function logout() {
            if (state.user) {
                state.onlineUsers[state.user.id] = false;
            }
            state.user = null;
            state.view = 'login';
            stopTimerInterval();
            stopActivityInterval();
            render();
        }

        function startTimerInterval() {
            if (timerInterval) return;
            timerInterval = setInterval(() => {
                let hasActiveTimers = false;
                Object.keys(state.timers).forEach(uid => {
                    if (state.timers[uid].running) {
                        state.timers[uid].elapsed++;
                        hasActiveTimers = true;
                    }
                });
                if (hasActiveTimers) {
                    updateTimerDisplay();
                }
                cleanExpiredCodes();
            }, 1000);
        }

        function stopTimerInterval() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function startActivityInterval() {
            if (activityInterval) return;
            activityInterval = setInterval(() => {
                updateActivity();
                checkOnlineStatus();
            }, 10000); // Cada 10 segundos
        }

        function stopActivityInterval() {
            if (activityInterval) {
                clearInterval(activityInterval);
                activityInterval = null;
            }
        }

        function genCode() {
            const code = Math.random().toString(36).substring(2,8).toUpperCase();
            const expires = Date.now() + (2 * 60 * 1000); // 2 minutos
            state.codes[code] = {
                altoId: state.user.id,
                altoName: state.user.name,
                expires: expires,
                used: false
            };
            save();
            alert('C√≥digo generado: ' + code + '\n‚è±Ô∏è Expira en 2 minutos');
            render();
        }

        function genAdminCode() {
            const code = Math.random().toString(36).substring(2,8).toUpperCase();
            const expires = Date.now() + (5 * 60 * 1000); // 5 minutos para admins
            state.adminCodes[code] = {
                adminId: state.user.id,
                adminName: state.user.name,
                expires: expires,
                used: false
            };
            save();
            alert('C√≥digo de autorizaci√≥n Admin: ' + code + '\n‚è±Ô∏è Expira en 5 minutos');
            render();
        }

        function startTimer() {
            const code = document.getElementById('code').value.toUpperCase().trim();
            if (!code) {
                alert('Ingresa un c√≥digo');
                return;
            }
            if (!state.codes[code]) {
                alert('C√≥digo inv√°lido o expirado');
                return;
            }
            if (state.codes[code].used) {
                alert('Este c√≥digo ya fue utilizado');
                return;
            }
            const now = Date.now();
            if (state.codes[code].expires && now > state.codes[code].expires) {
                alert('Este c√≥digo ha expirado');
                delete state.codes[code];
                save();
                return;
            }
            state.timers[state.user.id] = {
                elapsed: 0,
                running: true,
                altoId: state.codes[code].altoId,
                altoName: state.codes[code].altoName,
                code: code
            };
            state.codes[code].used = true;
            save();
            render();
        }

        function stopUserTimer(uid) {
            const t = state.timers[uid];
            if (t) {
                const mins = Math.floor(t.elapsed/60);
                const h = Math.floor(mins/60);
                const m = mins%60;
                const s = t.elapsed%60;
                const u = state.users.find(x => x.id === uid);
                state.records.push({
                    id: state.records.length+1,
                    userId: uid,
                    userName: u.name,
                    altoId: t.altoId,
                    altoName: t.altoName,
                    secs: t.elapsed,
                    h: h,
                    m: m,
                    s: s,
                    date: new Date().toISOString(),
                    stoppedBy: state.user.name
                });
                delete state.timers[uid];
                save();
                alert(`Detenido: ${u.name} - ${h}h ${m}m ${s}s`);
                render();
            }
        }

        function addUser(e) {
            e.preventDefault();
            const name = document.getElementById('un').value;
            const user = document.getElementById('uu').value;
            const pass = document.getElementById('up').value;
            const role = document.getElementById('ur').value;
            if (state.users.find(x => x.username === user)) {
                alert('Usuario ya existe');
                return;
            }
            state.users.push({id: state.users.length+1, username: user, password: pass, role: role, name: name});
            save();
            alert('Usuario creado');
            render();
        }

        function editUser(id) {
            state.editingUser = state.users.find(u => u.id === id);
            render();
        }

        function saveUserEdit(e) {
            e.preventDefault();
            const user = state.users.find(u => u.id === state.editingUser.id);
            user.name = document.getElementById('editName').value;
            user.username = document.getElementById('editUsername').value;
            user.password = document.getElementById('editPassword').value;
            user.role = document.getElementById('editRole').value;
            state.editingUser = null;
            save();
            alert('Usuario actualizado');
            render();
        }

        function cancelUserEdit() {
            state.editingUser = null;
            render();
        }

        function changePassword(e) {
            e.preventDefault();
            const currentPass = document.getElementById('currentPass').value;
            const newPass = document.getElementById('newPass').value;
            const confirmPass = document.getElementById('confirmPass').value;
            
            if (state.user.password !== currentPass) {
                alert('Contrase√±a actual incorrecta');
                return;
            }
            if (newPass !== confirmPass) {
                alert('Las contrase√±as nuevas no coinciden');
                return;
            }
            if (newPass.length < 3) {
                alert('La contrase√±a debe tener al menos 3 caracteres');
                return;
            }
            
            const user = state.users.find(u => u.id === state.user.id);
            user.password = newPass;
            state.user.password = newPass;
            state.changingPassword = false;
            save();
            alert('‚úÖ Contrase√±a cambiada exitosamente');
            render();
        }

        function addActa(e) {
            e.preventDefault();
            const uid = parseInt(document.getElementById('au').value);
            const mot = document.getElementById('am').value;
            const authCode = document.getElementById('actaAuth')?.value?.toUpperCase().trim();
            
            // Si es Cargo Alto, necesita c√≥digo de autorizaci√≥n
            if (state.user.role === 'alto') {
                if (!authCode) {
                    alert('Necesitas un c√≥digo de autorizaci√≥n de un Admin');
                    return;
                }
                if (!state.adminCodes[authCode]) {
                    alert('C√≥digo de autorizaci√≥n inv√°lido o expirado');
                    return;
                }
                if (state.adminCodes[authCode].used) {
                    alert('Este c√≥digo ya fue utilizado');
                    return;
                }
                const now = Date.now();
                if (state.adminCodes[authCode].expires && now > state.adminCodes[authCode].expires) {
                    alert('Este c√≥digo ha expirado');
                    delete state.adminCodes[authCode];
                    save();
                    return;
                }
                state.adminCodes[authCode].used = true;
            }
            
            const u = state.users.find(x => x.id === uid);
            state.actas.push({
                id: state.actas.length+1,
                uid: uid,
                uname: u.name,
                mot: mot,
                by: state.user.name,
                byRole: state.user.role,
                date: new Date().toISOString()
            });
            save();
            alert('Acta creada');
            render();
        }

        function editActa(id) {
            state.editingActa = state.actas.find(a => a.id === id);
            render();
        }

        function saveActa(e) {
            e.preventDefault();
            const newMot = document.getElementById('editMot').value;
            const acta = state.actas.find(a => a.id === state.editingActa.id);
            acta.mot = newMot;
            acta.edited = true;
            acta.editedBy = state.user.name;
            acta.editedDate = new Date().toISOString();
            state.editingActa = null;
            save();
            alert('Acta actualizada');
            render();
        }

        function cancelEdit() {
            state.editingActa = null;
            render();
        }

        function addCom(e) {
            e.preventDefault();
            if (state.coms.length >= 10) {
                alert('M√°ximo 10 comunicados');
                return;
            }
            const tit = document.getElementById('ct').value;
            const con = document.getElementById('cc').value;
            const urg = document.getElementById('cu').checked;
            state.coms.push({
                id: state.coms.length+1,
                tit: tit,
                con: con,
                urg: urg,
                by: state.user.name,
                date: new Date().toISOString()
            });
            save();
            alert('Comunicado creado');
            render();
        }

        function delCom(id) {
            if (confirm('¬øEliminar este comunicado?')) {
                state.coms = state.coms.filter(x => x.id !== id);
                save();
                render();
            }
        }

        function addManual(e) {
            e.preventDefault();
            const uid = parseInt(document.getElementById('mu').value);
            const h = parseInt(document.getElementById('mh').value) || 0;
            const m = parseInt(document.getElementById('mm').value) || 0;
            const s = parseInt(document.getElementById('ms').value) || 0;
            const u = state.users.find(x => x.id === uid);
            const secs = (h * 3600) + (m * 60) + s;
            state.records.push({
                id: state.records.length+1,
                userId: uid,
                userName: u.name,
                altoId: state.user.id,
                altoName: state.user.name,
                secs: secs,
                h: h,
                m: m,
                s: s,
                date: new Date().toISOString(),
                manual: true
            });
            save();
            alert(`Tiempo agregado: ${h}h ${m}m ${s}s a ${u.name}`);
            render();
        }

        function addTeamMember(e) {
            e.preventDefault();
            const name = document.getElementById('teamName').value;
            const avatar = document.getElementById('teamAvatar').value;
            const desc = document.getElementById('teamDesc').value;
            state.team.push({name, avatar, desc});
            save();
            alert('Miembro agregado al equipo');
            render();
        }

        function delTeamMember(idx) {
            if (confirm('¬øEliminar este miembro?')) {
                state.team.splice(idx, 1);
                save();
                render();
            }
        }

        function calcStats() {
            const st = {};
            state.records.forEach(r => {
                if (!r.altoId) return;
                if (!st[r.altoId]) {
                    st[r.altoId] = {name: r.altoName, tot: 0, pend: 0, comp: 0};
                }
                const mins = Math.floor(r.secs/60);
                st[r.altoId].tot += mins;
                const newT = st[r.altoId].pend + mins;
                const ch = Math.floor(newT/60);
                const rm = newT%60;
                st[r.altoId].comp += ch;
                st[r.altoId].pend = rm;
            });
            return Object.values(st);
        }

        function getStatusBadge(userId) {
            return state.onlineUsers[userId] ? 
                '<span class="text-xs bg-green-500 text-white px-2 py-1 rounded-full">üü¢ Online</span>' :
                '<span class="text-xs bg-gray-400 text-white px-2 py-1 rounded-full">‚ö´ Offline</span>';
        }

        function render() {
            updateActivity();
            const app = document.getElementById('app');
            
            if (state.view === 'login') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-blue-900 to-blue-700 flex items-center justify-center p-4">
                        <div class="bg-white rounded-xl shadow-2xl p-8 w-full max-w-md">
                            <h1 class="text-4xl font-bold text-blue-900 text-center mb-2">GestorFederal</h1>
                            <p class="text-gray-600 text-center mb-6">Sistema de Control de Tiempos</p>
                            <form onsubmit="login(event)" class="space-y-4">
                                <input type="text" id="u" placeholder="Usuario" required class="w-full px-4 py-3 border rounded-lg">
                                <input type="password" id="p" placeholder="Contrase√±a" required class="w-full px-4 py-3 border rounded-lg">
                                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium">Ingresar</button>
                            </form>
                            <div class="mt-4 p-3 bg-gray-50 rounded text-sm">
                                <p class="font-medium">Prueba: admin / admin123</p>
                            </div>
                        </div>
                    </div>
                `;
            } else if (state.view === 'admin') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between items-center">
                                <h1 class="text-xl font-bold">GestorFederal - Admin</h1>
                                <div class="flex gap-2">
                                    <button onclick="state.changingPassword=true;render()" class="bg-blue-700 px-4 py-2 rounded hover:bg-blue-600">üîë Cambiar Contrase√±a</button>
                                    <button onclick="logout()" class="bg-blue-700 px-4 py-2 rounded hover:bg-blue-600">Salir</button>
                                </div>
                            </div>
                        </nav>
                        ${state.changingPassword ? `
                        <div class="container mx-auto p-4">
                            <div class="bg-white rounded-lg shadow p-6 max-w-md mx-auto">
                                <h2 class="text-xl font-bold mb-4">üîë Cambiar Contrase√±a</h2>
                                <form onsubmit="changePassword(event)" class="space-y-4">
                                    <input type="password" id="currentPass" placeholder="Contrase√±a actual" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="newPass" placeholder="Nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <input type="password" id="confirmPass" placeholder="Confirmar nueva contrase√±a" required class="w-full px-4 py-2 border rounded">
                                    <div class="flex gap-2">
                                        <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">Guardar</button>
                                        <button type="button" onclick="state.changingPassword=false;render()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">Cancelar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                        ` : `
                        <div class="container mx-auto p-4">
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
                                <button onclick="state.view='users';render()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                    <h3 class="font-bold">üë• Usuarios</h3>
                                </button>
                                <button onclick="state.view='actas';render()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                    <h3 class="font-bold">üìÑ Actas</h3>
                                </button>
                                <button onclick="state.view='bit';render()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                    <h3 class="font-bold">üèÜ Bit√°cora</h3>
                                </button>
                                <button onclick="state.view='coms';render()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                    <h3 class="font-bold">üì¢ Comunicados</h3>
                                </button>
                                <button onclick="state.view='team';render()" class="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                    <h3 class="font-bold">üéÆ Nuestro Equipo</h3>
                                </button>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Generar C√≥digo de Autorizaci√≥n</h2>
                                <button onclick="genAdminCode()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700">üîê Generar C√≥digo Admin</button>
                                <p class="text-sm text-gray-600 mt-2">Los Cargos Altos necesitan este c√≥digo para crear actas administrativas</p>
                            </div>
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-2xl font-bold mb-4">Estad√≠sticas</h2>
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="bg-blue-50 p-4 rounded">
                                        <p class="text-sm text-gray-600">Usuarios</p>
                                        <p class="text-3xl font-bold text-blue-600">${state.users.length}</p>
                                    </div>
                                    <div class="bg-green-50 p-4 rounded">
                                        <p class="text-sm text-gray-600">Registros</p>
                                        <p class="text-3xl font-bold text-green-600">${state.records.length}</p>
                                    </div>
                                    <div class="bg-purple-50 p-4 rounded">
                                        <p class="text-sm text-gray-600">Actas</p>
                                        <p class="text-3xl font-bold text-purple-600">${state.actas.length}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `}
                    </div>
                `;
            } else if (state.view === 'users') {
                app.innerHTML = `
                    <div class="min-h-screen bg-gray-100">
                        <nav class="bg-blue-900 text-white p-4">
                            <div class="container mx-auto flex justify-between">
                                <h1 class="text-xl font-bold">Gesti√≥n de Usuarios</h1>
                                <button onclick="state.view='admin';render()" class="bg-blue-700 px-4 py-2 rounded">Volver</button>
                            </div>
                        </nav>
                        <div class="container mx-auto p-4">
                            ${state.editingUser ? `
                            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-6 mb-6 rounded-lg">
                                <h2 class="text-xl font-bold mb-4">‚úèÔ∏è Editando Usuario</h2>
                                <form onsubmit="saveUserEdit(event)" class="grid grid-cols-2 gap-4">
                                    <input type="text" id="editName" value="${state.editingUser.name}" placeholder="Nombre" required class="px-4 py-2 border rounded">
                                    <input type="text" id="editUsername" value="${state.editingUser.username}" placeholder="Usuario" required class="px-4 py-2 border rounded">
                                    <input type="password" id="editPassword" value="${state.editingUser.password}" placeholder="Contrase√±a" required class="px-4 py-2 border rounded">
                                    <select id="editRole" class="px-4 py-2 border rounded">
                                        <option value="bajo" ${state.editingUser.role==='bajo'?'selected':''}>Cargo Bajo</option>
                                        <option value="alto" ${state.editingUser.role==='alto'?'selected':''}>Cargo Alto</option>
                                        <option value="admin" ${state.editingUser.role==='admin'?'selected':''}>Admin</option>
                                    </select>
                                    <div class="col-span-2 flex gap-2">
                                        <button type="submit" class="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700">üíæ Guardar</button>
                                        <button type="button" onclick="cancelUserEdit()" class="flex-1 bg-gray-500 text-white py-2 rounded hover:bg-gray-600">‚ùå Cancelar</button>
                                    </div>
                                </form>
                            </div>
                            ` : `
                            <div class="bg-white rounded-lg shadow p-6 mb-6">
                                <h2 class="text-xl font-bold mb-4">Crear Usuario</h2>
                                <form onsubmit="addUser(event)" class="grid grid-cols-2 gap-4">
                                    <input type="text" id="un" placeholder="Nombre" required class="px-4 py-2 border rounded">
                                    <input type="text" id="uu" placeholder="Usuario" required class="px-4 py-2 border rounded">
                                    <input type="password" id="up" placeholder="Contrase√±a" required class="px-4 py-2 border rounded">
                                    <select id="ur" class="px-4 py-2 border rounded">
                                        <option value="bajo">Cargo Bajo</option>
                                        <option value="alto">Cargo Alto</option>
                                        <option value="admin">Admin</option>
                                    </select>
                                    <button type="submit" class="col-span-2 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Crear Usuario</button>
                                </form>
                            </div>
                            `}
                            <div class="bg-white rounded-lg shadow p-6">
                                <h2 class="text-xl font-bold mb-4">Lista de Usuarios</h2>
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-4 py-2 text-left">Estado</th>
                                                <th class="px-4 py-2 text-left">Nombre</th>
                                                <th class="px-4 py-2 text-left">Usuario</th>
                                                <th class="px-4 py-2 text-left">Rol</th>
                                                <th class="px-4 py-2 text-left">Contrase√±a</th>
                                                <th class="px-4 py-2 text-left">Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${state.users.map(u => `
                                            <tr class="border-t">
                                                <td class="px-4 py
